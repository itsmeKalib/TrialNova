<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Airship Shooter Game</title>
    <style>
      body {
        margin: 0;
        background: #111;
        overflow: hidden;
        color: white;
        font-family: sans-serif;
      }
      canvas {
        display: block;
      }
      #score, #score2 {
        position: absolute;
        top: 10px;
        font-size: 24px;
        font-weight: bold;
      }
      #score {
        left: 10px;
      }
      #score2 {
        left: 200px;
      }
      #healthBar, #healthBar2 {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        font-weight: bold;
        color: red;
      }
      #healthBar2 {
        right: 200px;
        color: orange;
      }
      #gameOverMessage {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 48px;
        color: white;
        display: none;
      }
      #restartBtn {
        position: absolute;
        top: 60%;
        left: 50%;
        transform: translateX(-50%);
        font-size: 20px;
        padding: 10px 20px;
        background: #28a745;
        color: white;
        border: none;
        display: none;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="score">P1 Score: 0</div>
    <div id="score2">P2 Score: 0</div>
    <div id="healthBar">P1 Health: 100%</div>
    <div id="healthBar2">P2 Health: 100%</div>
    <div id="gameOverMessage">Game Over</div>
    <button id="restartBtn">Restart</button>
    <canvas id="gameCanvas"></canvas>

    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      const keys = {};
      let bullets = [];
      let enemies = [];
      let rocks = [];
      let obstacles = [];
      let powerUps = [];
      let score = 0;
      let score2 = 0;
      let health = 100;
      let health2 = 100;
      let p1Dead = false;
      let p2Dead = false;
      let gameOver = false;

      const players = [
        {
          x: 100,
          y: 200,
          width: 40,
          height: 20,
          speed: 5,
          color: "red",
          up: "ArrowUp",
          down: "ArrowDown",
          left: "ArrowLeft",
          right: "ArrowRight",
          shoot: "Enter",
          healthId: "healthBar",
          scoreId: "score",
          health: () => health,
          setHealth: (v) => (health = v),
          isDead: () => p1Dead,
          setDead: (v) => (p1Dead = v),
          score: () => score,
          setScore: (v) => (score = v),
        },
        {
          x: 100,
          y: 400,
          width: 40,
          height: 20,
          speed: 5,
          color: "blue",
          up: "w",
          down: "s",
          left: "a",
          right: "d",
          shoot: " ",
          healthId: "healthBar2",
          scoreId: "score2",
          health: () => health2,
          setHealth: (v) => (health2 = v),
          isDead: () => p2Dead,
          setDead: (v) => (p2Dead = v),
          score: () => score2,
          setScore: (v) => (score2 = v),
        },
      ];

      function drawRect(x, y, w, h, color) {
        ctx.fillStyle = color;
        ctx.fillRect(x, y, w, h);
      }

      function shoot(playerIndex) {
        const p = players[playerIndex];
        if (p.isDead()) return;
        bullets.push({
          x: p.x + p.width,
          y: p.y + p.height / 2 - 2,
          width: 10,
          height: 4,
          speed: 8,
          color: p.color,
          owner: playerIndex,
        });
      }

      function spawnEnemy() {
        enemies.push({
          x: canvas.width,
          y: Math.random() * (canvas.height - 30),
          width: 30,
          height: 20,
          speed: 2 + Math.random() * 2,
          dy: (Math.random() - 0.5) * 2,
          color: "cyan",
        });
      }

      function spawnRock() {
        rocks.push({
          x: canvas.width,
          y: Math.random() * canvas.height,
          width: 20,
          height: 20,
          speed: 3,
          color: "gray",
        });
      }

      function spawnObstacle() {
        obstacles.push({
          x: canvas.width,
          y: Math.random() * canvas.height,
          width: 15,
          height: 60,
          speed: 2,
          color: "orange",
        });
      }

      function spawnPowerUp() {
        powerUps.push({
          x: canvas.width,
          y: Math.random() * (canvas.height - 20),
          width: 20,
          height: 20,
          speed: 2,
          color: "lime",
        });
      }

      function resetGame() {
        bullets = [];
        enemies = [];
        rocks = [];
        obstacles = [];
        powerUps = [];
        score = 0;
        score2 = 0;
        health = 100;
        health2 = 100;
        p1Dead = false;
        p2Dead = false;
        gameOver = false;
        players[0].x = 100;
        players[0].y = 200;
        players[1].x = 100;
        players[1].y = 400;
        document.getElementById("score").textContent = `P1 Score: ${score}`;
        document.getElementById("score2").textContent = `P2 Score: ${score2}`;
        document.getElementById("healthBar").textContent = `P1 Health: ${health}%`;
        document.getElementById("healthBar2").textContent = `P2 Health: ${health2}%`;
        document.getElementById("gameOverMessage").style.display = "none";
        document.getElementById("restartBtn").style.display = "none";
        gameLoop();
      }

      function update() {
        if (gameOver) return;

        players.forEach((p, i) => {
          if (p.isDead()) return;

          if (keys[p.up]) p.y -= p.speed;
          if (keys[p.down]) p.y += p.speed;
          if (keys[p.left]) p.x -= p.speed;
          if (keys[p.right]) p.x += p.speed;

          p.y = Math.max(0, Math.min(p.y, canvas.height - p.height));
          p.x = Math.max(0, Math.min(p.x, canvas.width - p.width));
        });

        bullets.forEach((b, i) => {
          b.x += b.speed;
          if (b.x > canvas.width) bullets.splice(i, 1);
        });

        enemies.forEach((e, i) => {
          e.x -= e.speed;
          e.y += e.dy;
          if (e.y < 0 || e.y + e.height > canvas.height) e.dy *= -1;
          if (e.x + e.width < 0) enemies.splice(i, 1);
        });

        rocks.forEach((r, i) => {
          r.x -= r.speed;
          if (r.x + r.width < 0) rocks.splice(i, 1);
          players.forEach((p) => {
            if (
              !p.isDead() &&
              p.x < r.x + r.width &&
              p.x + p.width > r.x &&
              p.y < r.y + r.height &&
              p.y + p.height > r.y
            ) {
              r.x = -100;
              let h = p.health() - 10;
              p.setHealth(h);
              if (h <= 0) {
                p.setDead(true);
                document.getElementById(p.healthId).textContent = `${p.healthId === 'healthBar' ? 'P1' : 'P2'} Health: 0%`;
              } else {
                document.getElementById(p.healthId).textContent = `${p.healthId === 'healthBar' ? 'P1' : 'P2'} Health: ${h}%`;
              }
            }
          });
        });

        if (p1Dead && p2Dead) {
          gameOver = true;
          document.getElementById("gameOverMessage").style.display = "block";
          document.getElementById("restartBtn").style.display = "inline-block";
        }

        obstacles.forEach((o, i) => {
          o.x -= o.speed;
          if (o.x + o.width < 0) obstacles.splice(i, 1);
        });

        powerUps.forEach((p, i) => {
          p.x -= p.speed;
          if (p.x + p.width < 0) powerUps.splice(i, 1);
        });

        bullets.forEach((b, bi) => {
          enemies.forEach((e, ei) => {
            if (
              b.x < e.x + e.width &&
              b.x + b.width > e.x &&
              b.y < e.y + e.height &&
              b.y + b.height > e.y
            ) {
              enemies.splice(ei, 1);
              bullets.splice(bi, 1);
              const shooter = players[b.owner];
              let s = shooter.score() + 10;
              shooter.setScore(s);
              document.getElementById(shooter.scoreId).textContent = `${shooter.scoreId === 'score' ? 'P1' : 'P2'} Score: ${s}`;
            }
          });
        });

        bullets.forEach((b, bi) => {
          obstacles.forEach((o) => {
            if (
              b.x < o.x + o.width &&
              b.x + b.width > o.x &&
              b.y < o.y + o.height &&
              b.y + b.height > o.y
            ) {
              bullets.splice(bi, 1);
            }
          });
        });

        powerUps.forEach((p, pi) => {
          players.forEach((pl) => {
            if (
              !pl.isDead() &&
              pl.x < p.x + p.width &&
              pl.x + pl.width > p.x &&
              pl.y < p.y + p.height &&
              pl.y + pl.height > p.y
            ) {
              powerUps.splice(pi, 1);
              let s = pl.score() + 50;
              pl.setScore(s);
              document.getElementById(pl.scoreId).textContent = `${pl.scoreId === 'score' ? 'P1' : 'P2'} Score: ${s}`;
            }
          });
        });
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        players.forEach((p) => {
          if (!p.isDead()) drawRect(p.x, p.y, p.width, p.height, p.color);
        });
        bullets.forEach((b) => drawRect(b.x, b.y, b.width, b.height, b.color));
        enemies.forEach((e) => drawRect(e.x, e.y, e.width, e.height, e.color));
        rocks.forEach((r) => drawRect(r.x, r.y, r.width, r.height, r.color));
        obstacles.forEach((o) => drawRect(o.x, o.y, o.width, o.height, o.color));
        powerUps.forEach((p) => drawRect(p.x, p.y, p.width, p.height, p.color));
      }

      function gameLoop() {
        update();
        draw();
        if (!gameOver) requestAnimationFrame(gameLoop);
      }

      document.addEventListener("keydown", (e) => {
        keys[e.key] = true;
        players.forEach((p, i) => {
          if (e.key === p.shoot) shoot(i);
        });
      });

      document.addEventListener("keyup", (e) => {
        keys[e.key] = false;
      });

      document.getElementById("restartBtn").addEventListener("click", resetGame);

      setInterval(spawnEnemy, 2000);
      setInterval(spawnRock, 3000);
      setInterval(spawnObstacle, 4000);
      setInterval(spawnPowerUp, 8000);

      gameLoop();
    </script>
  </body>
</html>
